<div class="app">
  <!-- HEADER -->
  <header class="header">
    <div class="logo">PDF Annotator</div>
    <input type="file" accept="application/pdf" (change)="onFileSelected($event)" class="input-file" />

    <div class="controls">
      <button class="btn" (click)="prevPage()" [disabled]="!pdfDoc || pageIndex()===1">‚óÄ Prev</button>
      <span class="page-indicator">Page {{ pageIndex() }} / {{ pageCount || 0 }}</span>
      <button class="btn" (click)="nextPage()" [disabled]="!pdfDoc || pageIndex()===pageCount">Next ‚ñ∂</button>

      <button class="btn" (click)="zoomOut()" [disabled]="!pdfDoc">‚àí</button>
      <span class="page-indicator">Zoom {{ scale() | number:'1.0-2' }}√ó</span>
      <button class="btn" (click)="zoomIn()" [disabled]="!pdfDoc">+</button>

      <button class="btn danger" (click)="clearAll()" [disabled]="!coords().length">Clear</button>
      <button class="btn" (click)="copyJSON()" [disabled]="!coords().length">Copy JSON</button>
      <button class="btn" (click)="downloadJSON()" [disabled]="!coords().length">Download JSON</button>
    </div>
  </header>

  <!-- LATERAL SIDEBAR -->
  <aside class="sidebar">
    <h4>Anotaciones (JSON)</h4>
    <pre class="json">{{ coords() | json }}</pre>
  </aside>

  <!-- VISOR PDF -->
  <main class="viewer" *ngIf="pdfDoc as _">
    <div class="canvas-container">
      <canvas #pdfCanvas></canvas>
      <canvas #overlayCanvas></canvas>
      <div #annotationsLayer class="annotations-layer"></div>
      <div class="hitbox" (click)="onHitboxClick($event)"></div>

      <!-- NUEVA ANOTACI√ìN -->
      <div *ngIf="preview() as p" class="annotation-editor" #previewEditor [style.left.px]="p.x*scale()"
        [style.top.px]="pdfCanvasRef!.nativeElement.height - p.y*scale()">
        <input type="text" [(ngModel)]="p.value" placeholder="Texto..." />
        <input type="number" [(ngModel)]="p.size" min="8" max="72" />
        <input type="color" [(ngModel)]="p.color" />
        <button (click)="confirmPreview()">‚úÖ</button>
        <button (click)="cancelPreview()">‚ùå</button>
      </div>

      <!-- EDITAR ANOTACI√ìN -->
      <div *ngIf="editing() as e" class="annotation-editor editing" [style.left.px]="e.coord.x*scale()"
        [style.top.px]="pdfCanvasRef!.nativeElement.height - e.coord.y*scale()">
        <input type="text" [(ngModel)]="e.coord.value" placeholder="Texto..." />
        <input type="number" [(ngModel)]="e.coord.size" min="8" max="72" />
        <input type="color" [(ngModel)]="e.coord.color" />
        <button (click)="confirmEdit()">‚úÖ</button>
        <button (click)="cancelEdit()">‚ùå</button>
        <button class="btn-delete" (click)="deleteAnnotation()">üóëÔ∏è</button>
      </div>
    </div>
  </main>

  <main class="viewer empty" *ngIf="!pdfDoc">
    <p class="empty-text">Sube un PDF y haz click donde quieras a√±adir anotaciones. Ed√≠talas en la vista previa antes de
      confirmar ‚úÖ.</p>
  </main>
</div>