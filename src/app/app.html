<div class="app">
  <div class="header">
    <div class="badge">PDF Annotator</div>
    <input class="input" type="file" accept="application/pdf" (change)="onFileSelected($event)" />

    <div class="controls">
      <button class="btn" (click)="prevPage()" [disabled]="!pdfDoc || pageIndex() === 1">‚óÄ Prev</button>
      <div class="badge">Page {{ pageIndex() }} / {{ pageCount || 0 }}</div>
      <button class="btn" (click)="nextPage()" [disabled]="!pdfDoc || pageIndex() === pageCount">Next ‚ñ∂</button>

      <button class="btn" (click)="zoomOut()" [disabled]="!pdfDoc">‚àí</button>
      <div class="badge">Zoom {{ scale() | number:'1.0-2' }}√ó</div>
      <button class="btn" (click)="zoomIn()" [disabled]="!pdfDoc">+</button>

      <button class="btn" (click)="clearAll()" [disabled]="!coords().length">Clear</button>
      <button class="btn" (click)="copyJSON()" [disabled]="!coords().length">Copy JSON</button>
      <button class="btn" (click)="downloadJSON()" [disabled]="!coords().length">Download JSON</button>
    </div>
  </div>

  <div class="panel sidebar">
    <div class="small">Anotaciones (JSON)</div>
    <hr />
    <pre class="json">{{ coords() | json }}</pre>
  </div>

  <div class="panel viewer" *ngIf="pdfDoc as _">
    <div class="canvas-wrap">
      <canvas #pdfCanvas></canvas>
      <canvas #overlayCanvas></canvas>

      <!-- Layer de anotaciones -->
      <div #annotationsLayer class="annotations-layer"></div>

      <!-- Hitbox para crear anotaciones -->
      <div class="hitbox" (click)="onHitboxClick($event)"></div>

      <!-- Preview flotante -->
      <div *ngIf="preview() as p" class="preview" [style.left.px]="p.x * scale()"
        [style.top.px]="pdfCanvasRef!.nativeElement.height - p.y * scale()">
        <input type="text" [(ngModel)]="p.value" placeholder="Texto..." />
        <input type="number" [(ngModel)]="p.size" min="8" max="72" />
        <input type="color" [(ngModel)]="p.color" />
        <button (click)="confirmPreview()">‚úÖ</button>
        <button (click)="cancelPreview()">‚ùå</button>
      </div>

      <!-- Edit flotante -->
      <div *ngIf="editing() as e" class="preview" [style.left.px]="e.coord.x * scale()"
        [style.top.px]="pdfCanvasRef!.nativeElement.height - e.coord.y * scale()">
        <input type="text" [(ngModel)]="e.coord.value" placeholder="Texto..." />
        <input type="number" [(ngModel)]="e.coord.size" min="8" max="72" />
        <input type="color" [(ngModel)]="e.coord.color" />
        <button (click)="confirmEdit()">‚úÖ</button>
        <button (click)="cancelEdit()">‚ùå</button>
        <!-- NUEVO BOT√ìN DE BORRAR -->
        <button class="btn-delete" (click)="deleteAnnotation()">üóëÔ∏è</button>
      </div>

    </div>
  </div>

  <div class="panel viewer" *ngIf="!pdfDoc">
    <p class="small">Sube un PDF y haz click donde quieras a√±adir texto. Edita el contenido en la vista previa antes de
      confirmar ‚úÖ.</p>
  </div>
</div>